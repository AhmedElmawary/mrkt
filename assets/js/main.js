"use strict";const API_URL="api";function updateDasboard(){updateStats(),updateGraphs()}function updateStats(){const a={call:"dashboard_stats",args:{year:document.getElementById("stats_year").value,month:document.getElementById("stats_month").value,day:document.getElementById("stats_day").value}};callGraphApi(a,null,applyStats)}function updateGraphs(){const a={year:document.getElementById("graph_year").value,month:document.getElementById("graph_month").value,day:document.getElementById("graph_day").value};updateGraphUsersCount(a),updateGraphOrdersCount(a),updateGraphOrdersPriceSum(a),updateGraphOrdersPaymentMethod(a),updateGraphAvgRevenuePerStore(a),updateGraphRevenuePerStore(a)}function applyStats(a){for(const b in a)document.getElementById(b).innerHTML=a[b]}function updateGraphUsersCount(a){var b="month";"%"==a.day?"%"!=a.month&&(b="day"):b="hour";const c={graph_area_id:"graph-user-count",titles:["Users","Delivery staff"],time_order:b};callGraphApi({call:"graph_users_count",args:a},c,plotLineChart)}function updateGraphOrdersCount(a){var b="month";"%"==a.day?"%"!=a.month&&(b="day"):b="hour";const c={graph_area_id:"graph-orders-count",titles:["Completed","Canceled"],time_order:b};callGraphApi({call:"graph_orders_count",args:a},c,plotLineChart)}function updateGraphOrdersPriceSum(a){var b="month";"%"==a.day?"%"!=a.month&&(b="day"):b="hour";const c={graph_area_id:"graph-orders-price-sum",titles:["Completed","Canceled"],time_order:b};callGraphApi({call:"graph_orders_price_sum",args:a},c,plotLineChart)}function updateGraphOrdersPaymentMethod(a){callGraphApi({call:"graph_orders_payment_method",args:a},{graph_area_id:"graph-orders-payment-method"},plotPieChart)}function updateGraphAvgRevenuePerStore(a){callGraphApi({call:"graph_avg_revenue_per_store",args:a},{graph_area_id:"graph-avg-revenue-per-store"},plotBarChart)}function updateGraphRevenuePerStore(a){callGraphApi({call:"graph_revenue_per_store",args:a},{graph_area_id:"graph-revenue-per-store"},plotBarChart)}function callGraphApi(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){if(4==d.readyState&&200==d.status){const a=JSON.parse(d.responseText);return a?void c(a,b):void alert("Wrong JSON format!")}},d.open("POST",API_URL,!0),d.setRequestHeader("Content-type","application/json; charset=utf-8"),d.send(JSON.stringify(a))}function plotLineChart(a,b){var c=Math.ceil,d=jQuery("#"+b.graph_area_id);if(!a.length)return void(d[0].innerHTML="<p><mark>No data.</mark></p>");const e=[.7,.5];var f,g,h,k=1,l=12,m=0;for("hour"==b.time_order?(k=0,l=24):"day"==b.time_order&&(l=31),1==b.titles.length&&(a=[a]),g=0;g<b.titles.length;g++){for(h=0,f=0;f<a[g].length;f++)h+=a[g][f].value,a[g][f].value>m&&(m=a[g][f].value),a[g][f]=[a[g][f][b.time_order],a[g][f].value];a[g]={label:b.titles[g].trim()+" ("+h+")",data:a[g],lines:{show:!0,fill:!0,fillColor:{colors:[{opacity:e[g]},{opacity:e[g]}]}},points:{show:!0,radius:4}}}$.plot(d,a,{xaxis:{min:k,max:l,tickSize:1,tickDecimals:0},yaxis:{min:0,max:c(1.1*m),tickSize:c(m/10),tickDecimals:0},colors:["#abe37d","#faad7d"],grid:{borderWidth:1,hoverable:!0}}),createTooltips(d)}function plotBarChart(a,b){var c=Math.ceil,d=jQuery("#"+b.graph_area_id);if(!a.length)return void(d[0].innerHTML="<p><mark>No data.</mark></p>");var e,f=0,g=[],h=[];for(e=0;e<a.length;e++)g[g.length]={label:a[e].label+" ("+a[e].value+")",data:[[e,a[e].value]],bars:{show:!0,barWidth:a.length/4,lineWidth:0,align:"center",fillColor:{colors:[{opacity:.7},{opacity:.7}]}}},h[h.length]=[e,a[e].label],a[e].value>f&&(f=a[e].value);jQuery.plot(d,g,{legend:{show:!0},grid:{borderWidth:1,hoverable:!0},yaxis:{min:0,max:c(1.1*f),tickSize:c(f/10),tickDecimals:0,tickColor:"#f5f5f5"},xaxis:{ticks:h,tickColor:"#f5f5f5"}}),createTooltips(d)}function plotPieChart(a,b){var c=jQuery("#"+b.graph_area_id);return a.length?void $.plot(c,a,{legend:{show:!0},series:{pie:{show:!0,radius:1,label:{show:!0,radius:2/3,formatter:function(a,b){return"<div class=\"flot-pie-label\">"+a+"<br />"+Math.round(b.percent)+"%</div>"},background:{opacity:.7,color:"#000000"}}}}}):void(c[0].innerHTML="<p><mark>No data.</mark></p>")}function createTooltips(a){a.bind("plothover",function(a,b,c){if(jQuery(".js-flot-tooltip").remove(),!!c){const a="<strong>"+c.datapoint[1]+"</strong>";jQuery("<div class=\"js-flot-tooltip flot-tooltip\" align=\"center\">"+a+"</div>").css({top:c.pageY-45,left:c.pageX+5}).appendTo("body").show()}})}var BaseTableDatatables=function(){var a=function(){jQuery(".js-dataTable-full").dataTable({order:[],pageLength:50,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]})},b=function(){jQuery(".js-dataTable-full-pagination").dataTable({order:[],pagingType:"full_numbers",pageLength:50,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]]})},c=function(){jQuery(".js-dataTable-simple").dataTable({order:[],pageLength:50,lengthMenu:[[10,25,50,-1],[10,25,50,"All"]],searching:!1,oLanguage:{sLengthMenu:""},dom:"<'row'<'col-sm-12'tr>><'row'<'col-sm-6'i><'col-sm-6'p>>"})},d=function(){var a=jQuery.fn.dataTable;jQuery.extend(!0,a.defaults,{order:[],dom:"<'row'<'col-sm-6'l><'col-sm-6'f>><'row'<'col-sm-12'tr>><'row'<'col-sm-6'i><'col-sm-6'p>>",renderer:"bootstrap",oLanguage:{sLengthMenu:"_MENU_",sInfo:"Showing <strong>_START_</strong>-<strong>_END_</strong> of <strong>_TOTAL_</strong>",oPaginate:{sPrevious:"<i class=\"fa fa-angle-left\"></i>",sNext:"<i class=\"fa fa-angle-right\"></i>"}}}),jQuery.extend(a.ext.classes,{sWrapper:"dataTables_wrapper form-inline dt-bootstrap",sFilterInput:"form-control",sLengthSelect:"form-control"}),a.ext.renderer.pageButton.bootstrap=function(b,c,d,e,f,g){var h,i,j=new a.Api(b),k=b.oClasses,l=b.oLanguage.oPaginate,m=function(a,c){var e,n,o,p,q=function(a){a.preventDefault(),jQuery(a.currentTarget).hasClass("disabled")||j.page(a.data.action).draw(!1)};for(e=0,n=c.length;e<n;e++)if(p=c[e],jQuery.isArray(p))m(a,p);else{switch(h="",i="",p){case"ellipsis":h="&hellip;",i="disabled";break;case"first":h=l.sFirst,i=p+(0<f?"":" disabled");break;case"previous":h=l.sPrevious,i=p+(0<f?"":" disabled");break;case"next":h=l.sNext,i=p+(f<g-1?"":" disabled");break;case"last":h=l.sLast,i=p+(f<g-1?"":" disabled");break;default:h=p+1,i=f===p?"active":"";}h&&(o=jQuery("<li>",{class:k.sPageButton+" "+i,"aria-controls":b.sTableId,tabindex:b.iTabIndex,id:0===d&&"string"==typeof p?b.sTableId+"_"+p:null}).append(jQuery("<a>",{href:"#"}).html(h)).appendTo(a),b.oApi._fnBindAction(o,{action:p},q))}};m(jQuery(c).empty().html("<ul class=\"pagination\"/>").children("ul"),e)},a.TableTools&&(jQuery.extend(!0,a.TableTools.classes,{container:"DTTT btn-group",buttons:{normal:"btn btn-default",disabled:"disabled"},collection:{container:"DTTT_dropdown dropdown-menu",buttons:{normal:"",disabled:"disabled"}},print:{info:"DTTT_print_info"},select:{row:"active"}}),jQuery.extend(!0,a.TableTools.DEFAULTS.oTags,{collection:{container:"ul",button:"li",liner:"a"}}))};return{init:function(){d(),c(),a(),b()}}}();jQuery(function(){BaseTableDatatables.init()});const IMAGE_FILTER=["image/jpg","image/jpeg","image/png","image/bmp","image/gif"],VIDEO_FILTER=["video/mp4","video/webm","video/ogg"],DEFAULT_LAT=30.0120306,DEFAULT_LNG=31.3000488;var marker,map=null;function warnUser(){return confirm("Are you sure?")}function mapResize(){if(map){var a=!0;const d=document.getElementById("map_name").value.trim();var b=document.getElementById("map_latitude").value,c=document.getElementById("map_longitude").value;(""==b||""==c)&&(b=DEFAULT_LAT,c=DEFAULT_LNG,a=!1),b=parseFloat(b),c=parseFloat(c),google.maps.event.trigger(map,"resize"),map.setCenter({lat:b,lng:c}),a&&pinOnMap(marker,d,b,c)}}function initMap(){map=new google.maps.Map(document.getElementById("map_container"),{center:{lat:DEFAULT_LAT,lng:DEFAULT_LNG},zoom:10}),marker=new google.maps.Marker({map:map,position:null,draggable:!0}),map.addListener("click",function(a){const b=document.getElementById("map_name").value.trim();pinOnMap(marker,b,a.latLng.lat(),a.latLng.lng())}),map.addListener("rightclick",function(a){const b=document.getElementById("map_name").value.trim();pinOnMap(marker,b,a.latLng.lat(),a.latLng.lng())}),marker.addListener("position_changed",function(){const a=marker.getPosition();document.getElementById("map_latitude").value=a.lat(),document.getElementById("map_longitude").value=a.lng()})}function pinOnMap(a,b,c,d){const e=new google.maps.LatLng({lat:parseFloat(c),lng:parseFloat(d)});a.setTitle(b),a.setPosition(e),a.setAnimation(google.maps.Animation.DROP)}function coordinateChange(){var a=document.getElementById("map_latitude").value,b=document.getElementById("map_longitude").value;if(""!=a&&""!=b){const c=new google.maps.LatLng({lat:parseFloat(a),lng:parseFloat(b)});marker.setPosition(c)}}function showMedia(a,b){b=document.getElementById(b),b.innerHTML="";var c,d,e,f,g,h;for(c=0;c<a.files.length;c++){if(d=window.URL.createObjectURL(a.files[c]),f=a.files[c].type,-1<IMAGE_FILTER.indexOf(f))h=`
				<a class="img-link img-thumb" href="`+d+`">
					<img class="img-responsive" src="`+d+`" />
				</a>
			`;else if(-1<VIDEO_FILTER.indexOf(f))h=`
				<video class="img-responsive" controls>
					<source src="`+d+`" type="`+f+`" />
				</video>
			`;else continue;e=a.files[c].name.trim(),g=a.files[c].size/1048576,g=parseFloat(g.toFixed(2)),b.innerHTML+=`
			<div class="col-xs-6 col-sm-4 col-md-3 col-lg-2 animated fadeIn">
				`+h+`
				<div align="center">`+e+` (`+g+` MB)</div>
			</div>
		`}}function lazyLoadMedia(a){var b,c=document.querySelectorAll("."+a);for(b=0;b<c.length;b++)c[b].src=c[b].dataset.src.trim()}function toggleCheckboxes(a,b){var c,d=document.querySelectorAll("input."+b);for(c=0;c<d.length;c++)d[c].checked=a}function addFormNotify(a){var b,c=document.querySelectorAll("form."+a);for(b=0;b<c.length;b++)c[b].addEventListener("submit",function(){fireNotification({message:"Saving data in progress...",icon:"fa fa-spinner fa-spin",type:"success",delay:0})})}function fireNotification(a){$.notify({message:a.message,icon:a.icon},{type:a.type,delay:a.delay})}